# Development Dockerfile that runs Hasura with console for live migrations
FROM hasura/graphql-engine:v2.44.0

# Install curl and hasura CLI
RUN apt-get update && apt-get install -y curl && \
    curl -L https://github.com/hasura/graphql-engine/raw/stable/cli/get.sh | bash && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# Create working directory
WORKDIR /hasura

# Copy config and metadata
COPY config.yaml .
COPY migrations /hasura/migrations
COPY metadata /hasura/metadata

# Copy startup script
COPY entrypoint-dev.sh /entrypoint-dev.sh
RUN chmod +x /entrypoint-dev.sh

# Expose GraphQL engine and console ports
EXPOSE 8080 9695

ENTRYPOINT ["/entrypoint-dev.sh"]
